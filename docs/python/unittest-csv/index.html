<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link href="https://gavinw.me/pythonic/rss.xml" rel="alternate" type="application/rss+xml" title="RSS">
    <link href="https://gavinw.me/pythonic/styles.css" rel="stylesheet">
    <title>Pythonic</title>
</head>
<body>
<div class="container">
    
<div class="row">
<div class="col">
    <h1>Unittest CSV files</h1>
    
        <h6>November  8, 2022</h6>
    
    <hr>
    <p>The example below demonstrates a unit test for a function that writes data in a dictionary to CSV files.</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#65737e;"># save_to_csv.py
</span><span>
</span><span style="color:#b48ead;">import </span><span>numpy </span><span style="color:#b48ead;">as </span><span>np
</span><span style="color:#b48ead;">import </span><span>pathlib
</span><span>
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">save_to_csv</span><span>(</span><span style="color:#bf616a;">output</span><span>):
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    Save dictionary data to CSV files using the NumPy package.
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    Parameters
</span><span style="color:#65737e;">    ----------
</span><span style="color:#65737e;">    output : dict
</span><span style="color:#65737e;">        Dictionary of data to write to CSV files. Each key is used to create a
</span><span style="color:#65737e;">        CSV file where the values are written to the file.
</span><span style="color:#65737e;">
</span><span style="color:#65737e;">    Returns
</span><span style="color:#65737e;">    -------
</span><span style="color:#65737e;">        CSV files written to the current directory.
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>
</span><span>    </span><span style="color:#65737e;"># Create path for saving files
</span><span>    path = pathlib.</span><span style="color:#bf616a;">Path</span><span>(&#39;</span><span style="color:#a3be8c;">.</span><span>&#39;)
</span><span>    path.</span><span style="color:#bf616a;">mkdir</span><span>(</span><span style="color:#bf616a;">exist_ok</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>
</span><span>    </span><span style="color:#65737e;"># Save simulation output to CSV files
</span><span>    </span><span style="color:#b48ead;">for </span><span>k, v </span><span style="color:#b48ead;">in </span><span>output.</span><span style="color:#bf616a;">items</span><span>():
</span><span>        filename = k.</span><span style="color:#bf616a;">replace</span><span>(&#39; &#39;, &#39;</span><span style="color:#a3be8c;">_</span><span>&#39;) + &#39;</span><span style="color:#a3be8c;">.csv</span><span>&#39;
</span><span>        np.</span><span style="color:#bf616a;">savetxt</span><span>(path / filename, v, </span><span style="color:#bf616a;">delimiter</span><span>=&#39;</span><span style="color:#a3be8c;">, </span><span>&#39;)
</span><span>
</span><span>
</span><span style="color:#b48ead;">if </span><span>__name__ == &#39;</span><span style="color:#a3be8c;">__main__</span><span>&#39;:
</span><span>
</span><span>    weights = [</span><span style="color:#d08770;">4</span><span>, </span><span style="color:#d08770;">5.2</span><span>, </span><span style="color:#d08770;">8</span><span>, </span><span style="color:#d08770;">10</span><span>]
</span><span>    years = np.</span><span style="color:#bf616a;">array</span><span>([[</span><span style="color:#d08770;">1991</span><span>, </span><span style="color:#d08770;">2002</span><span>], [</span><span style="color:#d08770;">1887</span><span>, </span><span style="color:#d08770;">1706</span><span>]])
</span><span>    output = {&#39;</span><span style="color:#a3be8c;">weights</span><span>&#39;: weights, &#39;</span><span style="color:#a3be8c;">years</span><span>&#39;: years}
</span><span>
</span><span>    </span><span style="color:#bf616a;">save_to_csv</span><span>(output)
</span></code></pre>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#65737e;"># test_savetocsv.py
</span><span>
</span><span style="color:#b48ead;">import </span><span>numpy </span><span style="color:#b48ead;">as </span><span>np
</span><span style="color:#b48ead;">import </span><span>pathlib
</span><span style="color:#b48ead;">import </span><span>unittest
</span><span style="color:#b48ead;">from </span><span>save_to_csv </span><span style="color:#b48ead;">import </span><span>save_to_csv
</span><span>
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">TestSaveToCsv</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">unittest.TestCase</span><span style="color:#eff1f5;">):
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">setUp</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        weights = [</span><span style="color:#d08770;">4</span><span>, </span><span style="color:#d08770;">5.2</span><span>, </span><span style="color:#d08770;">8</span><span>, </span><span style="color:#d08770;">10</span><span>]
</span><span>        years = np.</span><span style="color:#bf616a;">array</span><span>([[</span><span style="color:#d08770;">1991</span><span>, </span><span style="color:#d08770;">2002</span><span>], [</span><span style="color:#d08770;">1887</span><span>, </span><span style="color:#d08770;">1706</span><span>]])
</span><span>        output = {&#39;</span><span style="color:#a3be8c;">weights</span><span>&#39;: weights, &#39;</span><span style="color:#a3be8c;">years</span><span>&#39;: years}
</span><span>        </span><span style="color:#bf616a;">save_to_csv</span><span>(output)
</span><span>
</span><span>        </span><span style="color:#bf616a;">self</span><span>.weights = weights
</span><span>        </span><span style="color:#bf616a;">self</span><span>.years = years
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">test_currents</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">with </span><span style="color:#96b5b4;">open</span><span>(&#39;</span><span style="color:#a3be8c;">weights.csv</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">r</span><span>&#39;) </span><span style="color:#b48ead;">as </span><span>f:
</span><span>            weight = </span><span style="color:#bf616a;">float</span><span>(f.</span><span style="color:#bf616a;">readline</span><span>())
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">assertEqual</span><span>(</span><span style="color:#bf616a;">self</span><span>.weights[</span><span style="color:#d08770;">0</span><span>], weight)
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">test_volts</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">with </span><span style="color:#96b5b4;">open</span><span>(&#39;</span><span style="color:#a3be8c;">years.csv</span><span>&#39;, &#39;</span><span style="color:#a3be8c;">r</span><span>&#39;) </span><span style="color:#b48ead;">as </span><span>f:
</span><span>            years = </span><span style="color:#bf616a;">list</span><span>(</span><span style="color:#96b5b4;">map</span><span>(float, f.</span><span style="color:#bf616a;">readline</span><span>().</span><span style="color:#bf616a;">split</span><span>(&#39;</span><span style="color:#a3be8c;">, </span><span>&#39;)))
</span><span>        </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">assertEqual</span><span>(</span><span style="color:#bf616a;">self</span><span>.years[</span><span style="color:#d08770;">0</span><span>][</span><span style="color:#d08770;">0</span><span>], years[</span><span style="color:#d08770;">0</span><span>])
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">tearDown</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        path = pathlib.</span><span style="color:#bf616a;">Path</span><span>(&#39;</span><span style="color:#a3be8c;">weights.csv</span><span>&#39;)
</span><span>        path.</span><span style="color:#bf616a;">unlink</span><span>(</span><span style="color:#bf616a;">missing_ok</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>
</span><span>        path = pathlib.</span><span style="color:#bf616a;">Path</span><span>(&#39;</span><span style="color:#a3be8c;">years.csv</span><span>&#39;)
</span><span>        path.</span><span style="color:#bf616a;">unlink</span><span>(</span><span style="color:#bf616a;">missing_ok</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span></code></pre>
<p>In the directory containing the files, run the unit test with the following terminal command:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python -m</span><span> unittest
</span></code></pre>

</div>
</div>
<div class="row my-5">
<div class="col">
    <p class="text-center small my-5">
        <a href="https://gavinw.me/pythonic/">Pythonic Programming</a> © 2023 <br>
        Built by <a href="https://gavinw.me">Gavin Wiggins</a>
    </p>
</div>
</div>

</div>
</body>
</html>